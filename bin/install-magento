#!/usr/bin/env bash

MAGEDIR=/var/www/html
cd $MAGEDIR

su www-data <<EOSU

    cd $MAGEDIR \
      && find . -type d -exec chmod 770 {} \; \
      && find . -type f -exec chmod 660 {} \; \
      && chmod u+x bin/magento

    echo "install composer"
    composer install

    echo "installing magento"
    bin/magento setup:install --base-url=$MAGENTO_URL --backend-frontname=admin --language=$MAGENTO_LANGUAGE --timezone=$MAGENTO_TIMEZONE --currency=$MAGENTO_DEFAULT_CURRENCY --db-host=$MYSQL_HOST --d
b-name=$MYSQL_DATABASE --db-user=$MYSQL_USER --db-password=$MYSQL_PASSWORD --use-secure=0 --base-url-secure=0 --use-secure-admin=0 --admin-firstname=$MAGENTO_ADMIN_FIRSTNAME --admin-lastname=$MAGENTO_
ADMIN_LASTNAME --admin-email=$MAGENTO_ADMIN_EMAIL --admin-user=$MAGENTO_ADMIN_USERNAME --admin-password=$MAGENTO_ADMIN_PASSWORD

EOSU
